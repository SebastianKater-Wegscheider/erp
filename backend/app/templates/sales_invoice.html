<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>Rechnung {{ invoice_number }}</title>
  </head>
  <body>
    <h1>Rechnung</h1>
    <div class="muted">Rechnungs-Nr.: {{ invoice_number }} · Datum: {{ order_date }}</div>

    <div class="spacer"></div>

    <div class="row">
      <div class="col box">
        <div class="muted">Leistungserbringer</div>
        <div><strong>{{ company_name }}</strong></div>
        <div style="white-space: pre-line;">{{ company_address }}</div>
        {% if company_email %}<div>{{ company_email }}</div>{% endif %}
        {% if company_vat_id %}<div>UID: {{ company_vat_id }}</div>{% endif %}
      </div>

      <div class="col box">
        <div class="muted">Kunde</div>
        <div><strong>{{ buyer_name }}</strong></div>
        {% if buyer_address %}<div style="white-space: pre-line;">{{ buyer_address }}</div>{% endif %}
        <div class="muted">Kanal: {{ channel }}</div>
      </div>
    </div>

    <div class="spacer"></div>

    {% if has_regular_lines %}
      <table>
        <thead>
          <tr>
            <th>Position</th>
            <th class="right">Netto (EUR)</th>
            <th class="right">USt (EUR)</th>
            <th class="right">Brutto (EUR)</th>
          </tr>
        </thead>
        <tbody>
          {% for line in lines %}
          <tr>
            <td>
              <div><strong>{{ line.title }}</strong></div>
              <div class="muted">
                {{ line.platform }} · {{ line.region }}{% if line.variant %} · {{ line.variant }}{% endif %}
              </div>
              {% if line.purchase_type == "DIFF" %}
                <div class="muted">Differenzbesteuerung gem. § 24 UStG (keine USt-Ausweisung)</div>
              {% endif %}
            </td>
            <td class="right">{{ line.net_eur or "" }}</td>
            <td class="right">{{ line.tax_eur or "" }}</td>
            <td class="right">{{ line.gross_eur }}</td>
          </tr>
          {% endfor %}

          {% if shipping_regular_gross_cents > 0 %}
          <tr>
            <td>Versand</td>
            <td class="right">{{ shipping_regular_net_eur }}</td>
            <td class="right">{{ shipping_regular_tax_eur }}</td>
            <td class="right">{{ shipping_regular_gross_eur }}</td>
          </tr>
          {% endif %}

          {% if shipping_margin_gross_cents > 0 %}
          <tr>
            <td>Versand (Differenzbesteuerung)</td>
            <td class="right"></td>
            <td class="right"></td>
            <td class="right">{{ shipping_margin_gross_eur }}</td>
          </tr>
          {% endif %}

          {% if has_diff_lines %}
            <tr>
              <td class="right total">Summe regelbesteuert</td>
              <td class="right total">{{ regular_total_net_eur }}</td>
              <td class="right total">{{ regular_total_tax_eur }}</td>
              <td class="right total">{{ regular_total_gross_eur }}</td>
            </tr>
            <tr>
              <td class="right total">Summe differenzbesteuert</td>
              <td class="right total"></td>
              <td class="right total"></td>
              <td class="right total">{{ margin_total_gross_eur }}</td>
            </tr>
            <tr>
              <td class="right total">Gesamt</td>
              <td class="right total"></td>
              <td class="right total"></td>
              <td class="right total">{{ total_gross_eur }}</td>
            </tr>
          {% else %}
            <tr>
              <td class="right total">Gesamt</td>
              <td class="right total">{{ regular_total_net_eur }}</td>
              <td class="right total">{{ regular_total_tax_eur }}</td>
              <td class="right total">{{ regular_total_gross_eur }}</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    {% else %}
      <table>
        <thead>
          <tr>
            <th>Position</th>
            <th class="right">Brutto (EUR)</th>
          </tr>
        </thead>
        <tbody>
          {% for line in lines %}
          <tr>
            <td>
              <div><strong>{{ line.title }}</strong></div>
              <div class="muted">
                {{ line.platform }} · {{ line.region }}{% if line.variant %} · {{ line.variant }}{% endif %}
              </div>
              <div class="muted">Differenzbesteuerung gem. § 24 UStG (keine USt-Ausweisung)</div>
            </td>
            <td class="right">{{ line.gross_eur }}</td>
          </tr>
          {% endfor %}

          {% if shipping_gross_cents > 0 %}
          <tr>
            <td>Versand</td>
            <td class="right">{{ shipping_margin_gross_eur }}</td>
          </tr>
          {% endif %}

          <tr>
            <td class="right total">Gesamt</td>
            <td class="right total">{{ total_gross_eur }}</td>
          </tr>
        </tbody>
      </table>
    {% endif %}

    <footer class="doc-footer">
      <div>
        <strong>Impressum</strong>: {{ company_name }} · <span style="white-space: pre-line;">{{ company_address }}</span>
        {% if company_email %} · {{ company_email }}{% endif %}
        {% if company_vat_id %} · UID: {{ company_vat_id }}{% endif %}
      </div>
      {% if company_small_business_notice %}
        <div>{{ company_small_business_notice }}</div>
      {% endif %}
      {% if has_diff_lines %}
        <div>Hinweis: Differenzbesteuerung gem. § 24 UStG – keine Umsatzsteuer-Ausweisung für differenzbesteuerte Positionen.</div>
      {% endif %}
    </footer>
  </body>
</html>
