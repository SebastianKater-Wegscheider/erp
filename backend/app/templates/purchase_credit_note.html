<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>Gutschrift {{ document_number }}</title>
  </head>
  <body class="purchase">
    <header class="letterhead">
      <div class="lh-left">
        <div class="lh-name">{{ company_name }}</div>
        <div class="lh-address preline">{{ company_address }}</div>
      </div>
      <div class="lh-right">
        {% if company_logo_path %}<img class="lh-logo" src="{{ company_logo_path }}" alt="Logo" />{% endif %}
        {% if company_email %}<div>{{ company_email }}</div>{% endif %}
        {% if company_vat_id %}<div>UID: {{ company_vat_id }}</div>{% endif %}
      </div>
    </header>

    <div class="letter-grid">
      <div class="recipient">
        <div class="small muted">Verkäufer</div>
        <div class="recipient-name">{{ counterparty_name }}</div>
        <div class="recipient-address preline">{{ counterparty_address or "" }}</div>

        <div class="spacer"></div>

        <div class="small muted">Identifikation</div>
        <table class="meta-table">
          <tr>
            <td>Geburtsdatum</td>
            <td class="right">{{ counterparty_birthdate or "" }}</td>
          </tr>
          <tr>
            <td>Ausweisnr.</td>
            <td class="right mono">{{ counterparty_id_number or "" }}</td>
          </tr>
        </table>
      </div>

      <div class="meta">
        <table class="meta-table">
          <tr>
            <td>Dokument-Nr.</td>
            <td class="right mono">{{ document_number }}</td>
          </tr>
          <tr>
            <td>Datum</td>
            <td class="right">{{ purchase_date }}</td>
          </tr>
          <tr>
            <td>Zahlungsart</td>
            <td class="right">{{ payment_source }}</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="subject">Gutschrift (Eigenbeleg) – Ankauf</div>
    <div class="subline">
      Ankauf von Gebrauchtwaren von einer Privatperson. Die Nachweise zum Ankauf sind unten dokumentiert.
    </div>

    <table class="items">
      <thead>
        <tr>
          <th class="col-pos">Pos</th>
          <th>Artikel</th>
          <th>SN/IMEI</th>
          <th>Zustand</th>
          <th class="right col-money">EK (EUR)</th>
        </tr>
      </thead>
      <tbody>
        {% for line in lines %}
          <tr>
            <td class="col-pos">{{ loop.index }}</td>
            <td>
              <div><strong>{{ line.title }}</strong></div>
              <div class="muted small">
                {{ line.platform }} · {{ line.region }}{% if line.variant %} · {{ line.variant }}{% endif %}
              </div>
            </td>
            <td class="mono">{{ line.serial_number or "" }}</td>
            <td>{{ line.condition }}</td>
            <td class="right col-money">{{ line.purchase_price_eur }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="grand-total-wrap">
      <div class="grand-total-box">
        <div class="grand-total-label">Gesamtsumme</div>
        <div class="grand-total-value mono">{{ total_amount_eur }} €</div>
      </div>
    </div>

    <div class="evidence">
      <div class="evidence-title">Belege / Nachweise</div>
      <table class="evidence-table">
        <tr>
          <td>Plattform / Quelle</td>
          <td>{{ source_platform or "" }}</td>
        </tr>
        <tr>
          <td>Anzeige-URL</td>
          <td class="mono">{{ listing_url or "" }}</td>
        </tr>
        <tr>
          <td>Notizen</td>
          <td>{{ purchase_notes or "" }}</td>
        </tr>
      </table>

      <div class="evidence-files-title">Hochgeladene Dateien</div>
      {% if purchase_attachments and purchase_attachments|length > 0 %}
        <table class="evidence-files-table">
          <thead>
            <tr>
              <th>Typ</th>
              <th>Datei</th>
              <th>Notiz</th>
              <th>Pfad</th>
            </tr>
          </thead>
          <tbody>
            {% for attachment in purchase_attachments %}
              <tr>
                <td>{{ attachment.kind_label }}</td>
                <td class="mono">{{ attachment.original_filename }}</td>
                <td>{{ attachment.note or "" }}</td>
                <td class="mono">{{ attachment.upload_path }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="muted small">Keine zusätzlichen Uploads hinterlegt.</div>
      {% endif %}
    </div>

    <footer class="doc-footer">
      <div>
        <strong>Impressum</strong>: {{ company_name }} · <span class="preline">{{ company_address }}</span>
        {% if company_email %} · {{ company_email }}{% endif %}
        {% if company_vat_id %} · UID: {{ company_vat_id }}{% endif %}
      </div>
      {% if company_small_business_notice %}
        <div>{{ company_small_business_notice }}</div>
      {% else %}
        <div>Hinweis: Privatankauf zur Differenzbesteuerung gem. § 24 UStG (keine USt-Ausweisung).</div>
      {% endif %}
    </footer>
  </body>
</html>
